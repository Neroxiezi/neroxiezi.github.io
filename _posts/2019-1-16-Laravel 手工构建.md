---
layout: post
title:  "Laravel 手工构建"
date:   2019-1-16 10:00:02 +0800
author: "南丞"
desc: "手工构建laravel 框架"

in_head: "<style> .article-content p{
  text-indent: 2em;
  line-height: 1.75rem;
}</style>"
---

## 手工构建laravel框架
构建过程分为项目初始化,路由组件添加,控制器模块添加,模型组件添加和视图组件添加。

#### 项目初始化:

首先在服务器的web目录下创建一个lara文件夹,在根目录下创建一个 **composer.json**文件,内容如下:

```
{
   "require":{

   }
}
```
除过上面的方法以外 还可以 用 composer 初始化,然后运行 **composer update** 执行成功以后 lara 文件夹下 会自动生成自动加载文件目录如下:

```
lara
  |
  |--vendor
       |
       |--composer
            |
            |--autoload_classmap.php 
            ...
       |--autoload.php
  |--composer.json         

```

#### 添加路由组件

完成项目初始化后,将进行第一个组件的添加, 首先登陆 composer 的包 网站 找到 **route**组件,其中可以看到组件名 **illuminate/routing**组件的详细信息, 这个组件中也有一个composer.json文件 文件中有所依赖的其他组件,包括 **symfony/routing**等组件,但是该组件还有一个 **illuminate/events**组件没有包含,需要在添加路由组件时一起添加,所以修改 composer.json 文件如下:

```
{
   "require":{
      "illuminate/routing":"*"
      "illuminate/events":"*"
   }
}
```
修改后然后执行 compoer update 命令，然后就会看到在vendor 目录下多了该插件的目录,或者我们可以修改 composer.json文件,直接运行下面命令,也会完成组件的安装:

```
composer require "illuminate/routing":"*"
composer require "illuminate/events":"*"
```



在完成路由组件的添加后该如何使用呢? 首先需要添加两个文件,一个是路由文件,另外一个事服务器程序入口文件。按照laravel框架的架构, 我们在 lara目录下创建一个app目录, 该目录主要存储项目开发的文件, 在该目录下创建一个Http目录，该目录用户存储处理Http请求的文件,在http目录下在创建一个routes.php文件,该文件就是索要创建的路由文件,添加路由文件只要代码如下:

**routes.php**

```php
<?php
$app['route']->get('/',function(){
  return '<h1>路由成功</h1>'
})

```

创建程序入口文件,按照laravel框架架构,public下面 有一个 index.php:

**index.php**

```php
<?php
// 调用自动加载文件, 添加自动加载函数

require __DIR__.'/../vendor/autoload.php';
//实例化服务容器,注册事件,路由服务提供者

$app = new Illuminate\Container\Container;
with(new Illuminate\Events\EventServiceProvider($app))->register();
with(new Illuminate\Routing\RoutingServiceProvider($app))->register();

//加载路由
require __DIR__ .'/../routes/routes.php';

//实例化请求并分发处理请求
$request = Illuminate\Http\Request::createFromGlobals();
$response = $app['router']->dispatch($request);

//返回请求想要
$response->send();

```

完成上述两个文件的添加后,通过访问网站根目录就可以得到相应的路由响应.在laravel 框架中一些功能 的生成都需要服务容器来实现,即, **Illuminate\Container\Container** 类的实例, 服务容器用于服务注册和解析,也就是说向服务容器注册能够实现某些功能的实例或回调函数,当需要使用这个功能从服务器中获取相应的实例来完成.

#### 添加控制器模块

按照laravel 目录架构, 在Http目录下创建Controllers目录.为了实现文件自动加载,这里使用 psr-4 进行自动加载.修改composer.json文件如下:

```
{
    "require": {
        "illuminate/routing": "*",
        "illuminate/events": "*"
    },
	"authoload":{
		"psr-4":{
			"App\\":"app/"
		}
	}
}
```
修改完composer.json后, 执行命令 **composer dump-autoload** 更新自动加载文件.

然后在Controllers 目录下 新建 indexController 控制器文件,内容如下:

```php
<?php

namespace App\Http\Controllers;

class IndexController 
{
	public function index() {
		return '<h1>控制器成功</h1>';
	}
}
```
然后在路由文件中 **routes.php** 中添加一条路由配置,内容如下:

```php
<?php
$app['router']->get('/',function(){
	return 123;
});

$app['router']->get('welcom','App\Http\Controllers\IndexController@index');
```
然后通过访问这个路由就会得到响应。
















